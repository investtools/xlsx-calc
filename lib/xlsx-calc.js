!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.XLSX_CALC_ASYNC=t():e.XLSX_CALC_ASYNC=t()}(this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";e.exports=function(e){this.setValue=function(t){e=t},this.calc=function(){return e}}},function(e,t,r){"use strict";e.exports=function(e){for(var t,r=e+1,n="",o=10;r>0&&o--;)t=(r-1)%26,n=String.fromCharCode(t+65)+n,r=(r-t-1)/26;return n}},function(e,t,r){"use strict";e.exports=function(e){for(var t=0,r=e.replace(/[0-9]+$/,""),n=r.length;n--;)t+=Math.pow(26,r.length-n-1)*(r.charCodeAt(n)-64);return t-1}},function(e,t,r){"use strict";const n=r(4);e.exports=function(e,t){var r=this;this.name="RefValue",this.str_expression=e,this.formula=t,r.parseRef=function(){var r,o,i;if(-1!=e.indexOf("!")){var s=e.split("!");o=n(s[0]),r=t.wb.Sheets[o],i=s[1]}else r=t.sheet,o=t.sheet_name,i=e;if(!r)throw Error("Sheet "+o+" not found.");return{sheet:r,sheet_name:o,cell_name:i,cell_full_name:o+"!"+i}},this.calc=function(){return new Promise((e,n)=>{var o=r.parseRef(),i=o.sheet,s=o.cell_name,a=o.cell_full_name;if(!i[s])return e(null);var c=t.formula_ref[a];if(!c)return e(i[s].v);if("new"===c.status)t.exec_formula(c).then(t=>{e(t)}).catch(n);else if("working"===c.status)n("Circular ref");else if("done"===c.status)return"e"===i[s].t&&n(i[s].w),e(i[s].v)})}}},function(e,t,r){"use strict";e.exports=function(e){var t=e.match(/^'(.*)'$/);return t?t[1]:e}},function(e,t,r){"use strict";const n=r(2),o=r(1),i=r(4);e.exports=function(e,t){this.name="Range",this.str_expression=e,this.formula=t,this.calc=function(){return new Promise((r,s)=>{try{var a,c,u;if(-1!=e.indexOf("!")){var l=e.split("!");c=i(l[0]),a=l[1]}else c=t.sheet_name,a=e;u=t.wb.Sheets[c];var f,p=a.split(":"),h=parseInt(p[0].replace(/^[A-Z]+/,""),10)||0,g=p[1].replace(/^[A-Z]+/,"");""===g&&u["!ref"]&&(g=u["!ref"].split(":")[1].replace(/^[A-Z]+/,"")),f=parseInt(""==g?"500000":g,10);var v=n(p[0]),m=n(p[1]),y=[];new Promise((e,r)=>{!function e(r,n,i,s,a,c,u,l,f,p){for(let h=i;h<=s;h++){let i;p?i=p:(i=[],n.push(i));for(let p=a;p<=c;p++){let a=o(p)+h,g=u+"!"+a;if(t.formula_ref[g]){if("working"===t.formula_ref[g].status)return void f("Circular ref");if("new"===t.formula_ref[g].status)return void t.exec_formula(t.formula_ref[g]).then(t=>{i.push(r[a].v),++p>c&&(p=0,h++),e(r,n,h,s,p,c,u,l,f,i)}).catch(f);"done"===t.formula_ref[g].status&&i.push(r[a].v)}else r[a]?i.push(r[a].v):i.push(null)}}l()}(u,y,h,f,v,m,c,e,r)}).then(()=>{r(y)}).catch(s)}catch(e){s(e)}})}}},function(e,t,r){"use strict";const n=r(0);e.exports=function(e){return new Promise((t,r)=>{let o=[],i=[];for(let t=0;t<e.length;t++){let s=e[t];if("object"==typeof s&&"function"==typeof s.calc){let e=s.calc();"object"==typeof e&&"function"==typeof e.then?(o.push(e),e.then(e=>{i[t]=new n(e)}).catch(r)):i[t]=new n(e)}else i[t]=s}Promise.all(o).then(()=>{t(i)}).catch(r)})}},function(e,t,r){"use strict";e.exports=function(e,t){var r={},n=[];for(var o in e.Sheets){var i=e.Sheets[o];for(var s in i)if(i[s].f){var a=r[o+"!"+s]={formula_ref:r,wb:e,sheet:i,sheet_name:o,cell:i[s],name:s,status:"new",exec_formula:t};n.push(a)}}return n}},function(e,t,r){"use strict";const n=r(1),o=r(2),i=r(9),s=r(7),a=r(15);var c=function(e){return new Promise((t,r)=>{!function e(t,r,n,o){r!==t.length?i(t[r]).then(i=>{e(t,r+1,n,o)}).catch(e=>{o(e)}):n()}(s(e,i),0,t,r)})};c.calculator=function(e){return new a(e,i)},c.set_fx=i.set_fx,c.exec_fx=i.exec_fx,c.col_str_2_int=o,c.int_2_col_str=n,c.import_functions=i.import_functions,c.import_raw_functions=i.import_raw_functions,e.exports=c},function(e,t,r){"use strict";const n=r(10),o=r(0),i=r(11),s=r(12);var a={},c={};f(r(13)),l(r(14));const u={"*":"multiply","+":"plus","-":"minus","/":"divide","^":"power","&":"concat","<":"lt",">":"gt","=":"eq"};function l(e,t){for(var r in e)c[r]=e[r]}function f(e,t){var r=(t=t||{}).prefix||"";for(var n in e){var o=e[n];"function"==typeof o?a[r+n]=o:"object"==typeof o&&f(o,p(t,{prefix:n+"."}))}}function p(e,t){var r=JSON.parse(JSON.stringify(e));for(var n in t)r[n]=t[n];return r}function h(e){var t;e.status="working";var r=e.cell.f;"="==r[0]&&(r=r.substr(1));for(var l=t=new n(e),f="",p=!1,h=!1,g=[{exp:l}],v=0;v<r.length;v++)if('"'==r[v])p?(l.push(new o(f)),p=!1,h=!0):p=!0,f="";else if(p)f+=r[v];else if("("==r[v]){var m,y=f.trim(),_=a[y],w=c[y];if(w)_=new s(w,e);else if(_)_=new i(_,e);else if(y)throw new Error('"'+e.sheet_name+'"!'+e.name+": Function "+f+" not found");m=new n(e),g.push({exp:m,special:_}),l=m,f=""}else if(u[r[v]])h||l.push(f),h=!1,l.push(r[v]),f="";else if(","===r[v]&&g[g.length-1].special)h=!1,g[g.length-1].exp.push(f),g[g.length-1].special.push(g[g.length-1].exp),g[g.length-1].exp=l=new n(e),f="";else if(")"==r[v]){var x,d=g.pop();(l=d.exp).push(f),x=l,f="",l=g[g.length-1].exp,d.special?(d.special.push(x),l.push(d.special)):l.push(x)}else f+=r[v];return t.push(f),t}function g(e){return h(e).update_cell_value()}g.set_fx=function(e,t){a[e]=t},g.exec_fx=function(e,t){return a[e].apply(this,t)},g.import_functions=f,g.import_raw_functions=l,g.build_expression=h,e.exports=g},function(e,t,r){"use strict";const n=r(0),o=r(3),i=r(5),s=r(6);let a=0;e.exports=function(e){var t,r=this;function c(e,t,r,n){"#N/A"==e.message?(t.cell.v=42,t.cell.t="e",t.cell.w=e.message,r()):n(e)}function u(t,r,o){for(var i=0;i<r.length;i++)if(r[i]===t)try{var s=o(r[i-1].calc(),r[i+1].calc());r.splice(i-1,3,new n(s)),i--}catch(t){throw console.error(t),Error(e.name+": evaluating "+e.cell.f+"\n"+t.message)}}r.id=++a,r.args=[],r.name="Expression",r.update_cell_value=function(){let t=!1;return new Promise((n,o)=>{try{var i=r.calc();"object"==typeof i&&"function"==typeof i.then?(t=!0,i.then(t=>{e.cell.v=t,"string"==typeof e.cell.v?e.cell.t="s":"number"==typeof e.cell.v&&(e.cell.t="n"),e.status="done",n(e.cell.v)}).catch(t=>{e.status="done",c(t,e,n,o)})):(e.cell.v=i,"string"==typeof e.cell.v?e.cell.t="s":"number"==typeof e.cell.v&&(e.cell.t="n"),n(e.cell.v))}catch(t){c(t,e,n,o)}finally{t||(e.status="done")}})},r.formula=e,r.calc=function(){return new Promise((e,t)=>{s(r.args.concat()).then(r=>{try{if(function(e){for(var t=e.length;t--;)if("-"===e[t]){var r=-e[t+1].calc();"string"!=typeof e[t-1]&&t>0?(e.splice(t,1,"+"),e.splice(t+1,1,new n(r))):e.splice(t,2,new n(r))}}(r),u("^",r,function(e,t){return Math.pow(+e,+t)}),u("*",r,function(e,t){return+e*+t}),u("/",r,function(e,t){return+e/+t}),u("+",r,function(e,t){return+e+ +t}),u("&",r,function(e,t){return""+e+t}),u("<",r,function(e,t){return e<t}),u(">",r,function(e,t){return e>t}),u(">=",r,function(e,t){return e>=t}),u("<=",r,function(e,t){return e<=t}),u("<>",r,function(e,t){return e!=t}),u("=",r,function(e,t){return e==t}),1==r.length)return"object"==typeof r[0]&&"function"==typeof r[0].then?void r[0].then(e).catch(t):"function"!=typeof r[0].calc?e(r[0]):e(r[0].calc());console.log("something is not right")}catch(e){t(e)}}).catch(t)})},r.push=function(s){var a;s&&("="===(a=isNaN(s)?"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+:[A-Z]+[0-9]+$/)?new i(s.trim().replace(/\$/g,""),e):"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+[0-9]+:[A-Z]+[0-9]+$/)?new i(s.trim().replace(/\$/g,""),e):"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[A-Z]+:[A-Z]+$/)?new i(s.trim().replace(/\$/g,""),e):"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+:[A-Z]+$/)?new i(s.trim().replace(/\$/g,""),e):"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[A-Z]+[0-9]+$/)?new o(s.trim().replace(/\$/g,""),e):"string"==typeof s&&s.trim().replace(/\$/g,"").match(/^[^!]+![A-Z]+[0-9]+$/)?new o(s.trim().replace(/\$/g,""),e):"string"!=typeof s||isNaN(s.trim().replace(/%$/,""))?s:new n(+s.trim().replace(/%$/,"")/100):new n(+s))&&(">"==t||"<"==t)||"<"==t&&">"===a?r.args[r.args.length-1]+=a:r.args.push(a),t=a)}}},function(e,t,r){"use strict";const n=r(6);e.exports=function(e){var t=this;t.name="UserFn",t.args=[],t.calc=function(){return new Promise((r,o)=>{n(t.args).then(n=>{try{r(e.apply(t,n.map(e=>e.calc())))}catch(e){o(e)}}).catch(o)})},t.push=function(e){t.args.push(e)}}},function(e,t,r){"use strict";e.exports=function(e){var t=this;t.name="UserRawFn",t.args=[],t.calc=function(){return e.apply(t,t.args)},t.push=function(e){t.args.push(e)}}},function(e,t,r){"use strict";let n={FLOOR:Math.floor,"_xlfn.FLOOR.MATH":Math.floor,ABS:Math.abs,SQRT:Math.sqrt,VLOOKUP:function(e,t,r){for(var n=0;n<t.length;n++)if(t[n][0]==e)return t[n][r-1];throw Error("#N/A")},MAX:function(){for(var e=null,t=arguments.length;t--;){var r=arguments[t];if(Array.isArray(r))for(var n=r,o=n.length;o--;)e=null==e||e<n[o]?n[o]:e;else isNaN(r)?console.log("WTF??",r):e=null==e||e<r?r:e}return e},SUM:l,MIN:function(){for(var e=null,t=arguments.length;t--;){var r=arguments[t];if(Array.isArray(r))for(var n=r,o=n.length;o--;)e=null==e||e>n[o]?n[o]:e;else isNaN(r)?console.log("WTF??",r):e=null==e||e>r?r:e}return e},CONCATENATE:function(){for(var e="",t=0;t<arguments.length;t++)e+=arguments[t];return e},IF:function(e,t,r){return e?t:r},PMT:function(e,t,r,n,o){if(o=o||0,n=n||0,0!=e){var i=Math.pow(1+e,t);return-e*(n+i*r)/((-1+i)*(1+e*o))}if(0!=t)return-(n+r)/t;return 0},COUNTA:u,IRR:function(e,t){var r=-2,n=1,o=0;do{for(var i=(r+n)/2,s=0,a=0;a<e.length;a++){var c=e[a];s+=c[0]/Math.pow(1+i,a)}s>0?(r===n&&(n+=Math.abs(i)),r=i):n=i,o++}while(Math.abs(s)>1e-6&&o<1e5);return i},"NORM.INV":c,"_xlfn.NORM.INV":c,STDEV:function(){var e=i(arguments);var t=function(e){return e.reduce(function(e,t){return e+t})/e.length}(e),r=e.map(function(e){return(e-t)*(e-t)});return Math.sqrt(r.reduce(function(e,t){return e+t})/(e.length-1))},AVERAGE:a,EXP:function(e){return Math.pow(Math.E,e)},LN:Math.log,"_xlfn.VAR.P":s,"VAR.P":s,"_xlfn.COVARIANCE.P":o,"COVARIANCE.P":o,TRIM:function(e){return(""+e).trim()},LEN:function(e){return(""+e).length},ISBLANK:function(e){return!e}};function o(e,t){if(e=i(e),t=i(t),e.length!=t.length)return"N/D";for(var r=1/e.length,n=l.apply(this,e)/e.length,o=l.apply(this,t)/t.length,s=0,a=0;a<e.length;a++)s+=(e[a]-n)*(t[a]-o);return s*r}function i(e){for(var t=[],r=0;r<e.length;r++){var n=e[r];if(Array.isArray(n)){for(var o=n,i=o.length;i--;)if("number"==typeof o[i])t.push(o[i]);else if(Array.isArray(o[i]))for(var s=o[i].length;s--;)"number"==typeof o[i][s]&&t.push(o[i][s])}else"number"==typeof n&&t.push(n)}return t}function s(){for(var e=a.apply(this,arguments),t=0,r=0,n=0;n<arguments.length;n++){var o=arguments[n];if(Array.isArray(o))for(var i=o,s=i.length;s--;)for(var c=i[s].length;c--;)null!==i[s][c]&&void 0!==i[s][c]&&(t+=Math.pow(i[s][c]-e,2),r++);else t+=Math.pow(o-e,2),r++}return t/r}function a(){return l.apply(this,arguments)/u.apply(this,arguments)}function c(e,t,r){if(e<0||e>1)throw"The probality p must be bigger than 0 and smaller than 1";if(r<0)throw"The standard deviation sigma must be positive";return 0==e?-1/0:1==e?1/0:0==r?t:(n=e-.5,Math.abs(n)<=.425?i=n*(((((((2509.0809287301227*(o=.180625-n*n)+33430.57558358813)*o+67265.7709270087)*o+45921.95393154987)*o+13731.69376550946)*o+1971.5909503065513)*o+133.14166789178438)*o+3.3871328727963665)/(((((((5226.495278852854*o+28729.085735721943)*o+39307.89580009271)*o+21213.794301586597)*o+5394.196021424751)*o+687.1870074920579)*o+42.31333070160091)*o+1):(o=n>0?1-e:e,i=(o=Math.sqrt(-Math.log(o)))<=5?(((((((.0007745450142783414*(o+=-1.6)+.022723844989269184)*o+.2417807251774506)*o+1.2704582524523684)*o+3.6478483247632045)*o+5.769497221460691)*o+4.630337846156546)*o+1.4234371107496835)/(((((((1.0507500716444169e-9*o+.0005475938084995345)*o+.015198666563616457)*o+.14810397642748008)*o+.6897673349851)*o+1.6763848301838038)*o+2.053191626637759)*o+1):(((((((2.0103343992922881e-7*(o+=-5)+27115555687434876e-21)*o+.0012426609473880784)*o+.026532189526576124)*o+.29656057182850487)*o+1.7848265399172913)*o+5.463784911164114)*o+6.657904643501103)/(((((((2.0442631033899397e-15*o+1.421511758316446e-7)*o+18463183175100548e-21)*o+.0007868691311456133)*o+.014875361290850615)*o+.1369298809227358)*o+.599832206555888)*o+1),n<0&&(i=-i)),t+r*i);var n,o,i}function u(){for(var e=0,t=arguments.length;t--;){var r=arguments[t];if(Array.isArray(r))for(var n=r,o=n.length;o--;)for(var i=n[o].length;i--;)null!==n[o][i]&&void 0!==n[o][i]&&e++;else null!==r&&void 0!==r&&e++}return e}function l(){for(var e=0,t=arguments.length;t--;){var r=arguments[t];if(Array.isArray(r))for(var n=r,o=n.length;o--;)for(var i=n[o].length;i--;)isNaN(n[o][i])||(e+=+n[o][i]);else e+=+r}return e}e.exports=n},function(e,t,r){"use strict";const n=r(1),o=r(2),i=r(0),s=r(5),a=r(3);function c(e,t,r){let n=e.calc();"object"==typeof n&&"function"==typeof n.then?n.then(e=>{t(e)}).catch(e=>{r(e)}):t(n)}e.exports={OFFSET:function(e,t,r,c,u){if(c=(c||new i(1)).calc(),u=(u||new i(1)).calc(),1===e.args.length&&"RefValue"===e.args[0].name){var l=e.args[0],f=l.parseRef(),p=o(f.cell_name)+r.calc(),h=n(p),g=+f.cell_name.replace(/^[A-Z]+/g,"")+t.calc(),v=h+g;if(1===c&&1===u)return new a(v,l.formula).calc();var m=n(p+u-1)+(g+c-1),y=f.sheet_name+"!"+v+":"+m;return new s(y,l.formula).calc()}},IFERROR:function(e,t){return new Promise((r,n)=>{try{e.calc().then(e=>{void 0===e?c(t,r,n):"number"!=typeof e||!isNaN(e)&&e!==1/0&&e!==-1/0?r(e):c(t,r,n)}).catch(e=>{c(t,r,n)})}catch(e){return t.calc()}})}}},function(e,t,r){"use strict";const n=r(0),o=r(7);e.exports=class{constructor(e,t){this.workbook=e,this.expressions=[],this.exec_formula=t,this.variables={};let r=o(e,t);for(let e=r.length-1;e>=0;e--){let n=t.build_expression(r[e]);this.expressions.push(n)}}setVar(e,t){let r=this.variables[e];r?r.setValue(t):this.expressions.forEach(r=>{this.setVarOfExpression(r,e,t)})}setVarOfExpression(e,t,r){for(let o=0;o<e.args.length;o++){let i=e.args[o];i===t?e.args[o]=this.variables[t]||(this.variables[t]=new n(r)):"object"!=typeof i||"Expression"!==i.name&&"UserFn"!==i.name||this.setVarOfExpression(i,t,r)}}execute(){let e=this.expressions.map(e=>e.update_cell_value());return Promise.all(e)}}}])});
//# sourceMappingURL=xlsx-calc.js.map